- name: Update CR status field
  ignore_errors: yes
  uri:
    url: "https://{{ lookup('env', 'KUBERNETES_SERVICE_HOST') }}:{{ lookup('env', 'KUBERNETES_SERVICE_PORT_HTTPS') | default(lookup('env', 'KUBERNETES_SERVICE_PORT')) }}/apis/{{ current_cr.apiVersion }}/namespaces/{{ current_cr.metadata.namespace }}/{{ current_cr.kind | lower }}s/{{ current_cr.metadata.name }}/status"
    method: PATCH
    headers:
      Authorization: "Bearer {{ lookup('file', '/var/run/secrets/kubernetes.io/serviceaccount/token') }}"
      Content-Type: "application/merge-patch+json"
    body_format: json
    body:
      status: "{{ status_vars }}"
    ca_path: "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
    status_code: [200]
